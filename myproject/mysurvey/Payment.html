{% load otree static %}

{{ block title }}
<b>Section 2: Digital Payment Method Usage in general and Buy Now Pay Later Options</b>
{{ endblock }}

{{ block content }}

<hr style="margin: 28px 0;">

<!-- ===================== Q6 ===================== -->
<p><b>{{ form.payment_methods.label }}</b></p>

<!-- THIS is what oTree will save into player.payment_methods -->
<input type="hidden" name="payment_methods" id="payment_methods_hidden">

<div class="img-choice-grid">

    <label class="img-choice">
        <input type="checkbox" class="pm" value="Credit_cards">
        <img src="{% static 'img/credit.jpg' %}" alt="Credit cards">
        <div class="caption">Credit cards</div>
    </label>

    <label class="img-choice">
        <input type="checkbox" class="pm" value="Debit_cards">
        <img src="{% static 'img/debit.jpg' %}" alt="Debit cards">
        <div class="caption">Debit cards</div>
    </label>

    <label class="img-choice">
        <input type="checkbox" class="pm" value="Digital_wallets">
        <img src="{% static 'img/wallet.png' %}" alt="Digital wallets">
        <div class="caption">Digital wallets <small>(e.g., PayPal, Apple Pay)</small></div>
    </label>

    <label class="img-choice">
        <input type="checkbox" class="pm" value="BNPL">
        <img src="{% static 'img/bnpl.jpg' %}" alt="BNPL">
        <div class="caption">BNPL <small>(e.g., Klarna, PayPal Pay in 4)</small></div>
    </label>

    <label class="img-choice">
        <input type="checkbox" class="pm" value="Cryptocurrency">
        <img src="{% static 'img/crypto.jpg' %}" alt="Cryptocurrency">
        <div class="caption">Cryptocurrency</div>
    </label>

    <label class="img-choice">
        <input type="checkbox" class="pm" value="Other">
        <img src="{% static 'img/other.png' %}" alt="Other">
        <div class="caption">Other</div>
    </label>

</div>

<hr style="margin: 28px 0;">

<!-- ===================== Q7 ===================== -->
<p><b>{{form.factor_ranking.label}}</b></p>

<!-- Saved into player.q7_ranking -->
<input type="hidden" name="factor_ranking" id="factor_ranking">

<ol id="rankList" class="rank-list">
    <li class="rank-item" data-value="Convenience"><span class="num">1</span> Convenience</li>
    <li class="rank-item" data-value="Security"><span class="num">2</span> Security</li>
    <li class="rank-item" data-value="Trust in provider"><span class="num">3</span> Trust in provider</li>
    <li class="rank-item" data-value="Cost"><span class="num">4</span> Cost (e.g., no interest)</li>
    <li class="rank-item" data-value="Speed"><span class="num">5</span> Speed</li>
</ol>

<hr style="margin: 28px 0;">

<!-- ===================== Q8 ===================== -->

<div class="question-block">
    <p class="question-title">
        <b>{{ form.bnpl_frequency.label }}</b>
    </p>

    <div class="likert-horizontal">
        {{ form.bnpl_frequency }}
    </div>
</div>


{{ next_button }}

<!-- SortableJS for drag ranking -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

<script>
    // ---------- Q6: collect checked payment methods ----------
    function syncPaymentMethods() {
    const vals = Array.from(document.querySelectorAll('input.pm:checked')).map(x => x.value);
    document.getElementById('payment_methods_hidden').value = vals.join(', ');
    }

    document.querySelectorAll('input.pm').forEach(cb => cb.addEventListener('change', syncPaymentMethods));
    syncPaymentMethods();

    // ---------- Q7: drag-and-drop ranking ----------
    const list = document.getElementById('rankList');
    const hiddenRank = document.getElementById('factor_ranking');

    function updateNumbersAndHidden() {
        const items = Array.from(list.querySelectorAll('.rank-item'));
        items.forEach((item, i) => item.querySelector('.num').textContent = (i + 1));
        const order = items.map(item => item.dataset.value);
        hiddenRank.value = order.join(' | ');
    }

    new Sortable(list, {
        animation: 150,
        onSort: updateNumbersAndHidden
    });

    updateNumbersAndHidden();
</script>

<style>
    /* Q6 */
    .img-choice-grid { display:flex; gap:18px; flex-wrap:wrap; margin-top:10px; }
    .img-choice { cursor:pointer; text-align:center; }
    .img-choice input { display:none; }
    .img-choice img{
    width:170px; height:110px; object-fit:cover;
    border:3px solid transparent; border-radius:10px;
    transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .img-choice:hover img{ transform: scale(1.03); box-shadow: 0 6px 14px rgba(0,0,0,.15); }
    .img-choice input:checked + img{ border-color:#0d6efd; }
    .caption{ margin-top:6px; font-weight:500; }
    .caption small{ font-weight:400; color:#666; }

    /* Q7 */
    .rank-list{
        list-style:none;
        padding:0;
        margin-top:14px;
        max-width:560px;
    }
    .rank-item{
        display:flex;
        align-items:center;
        gap:12px;
        padding:12px 14px;
        margin:10px 0;
        background:#f3f4f6;
        border-radius:10px;
        cursor:grab;
        user-select:none;
    }
    .rank-item:active{ cursor:grabbing; }
    .num{
        width:28px; height:28px; border-radius:999px;
        display:flex; align-items:center; justify-content:center;
        background:#111827; color:#fff; font-weight:700;
        flex:0 0 28px;
    }

    /* Q8 */
    .question-block {
        margin-top: 30px;
        padding: 18px 20px;
        background: #f9fafb;
        border-radius: 12px;
    }

</style>

{{ endblock }}
