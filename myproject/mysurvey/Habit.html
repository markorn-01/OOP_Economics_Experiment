{% load otree static %}

{{ block title }}
<b>Section 4: Impulse Shopping Habit</b>
{{ endblock }}

{{ block content }}

<p>
  In this section, we want to know your strength of habit by measuring
  <b>SRHI (Self Report Habit Index)</b>.
</p>

<hr style="margin: 28px 0;">

<!-- ===================== Q14 ===================== -->
<p><b>Q14: On a scale of 1–5 (1 = Strongly disagree, 5 = Strongly agree), please rate these statements:</b></p>
<p>Unplanned shopping is something …</p>

<div class="q14-scale">
  <div class="q14-anchors">
    <div><b>1: Strongly disagree</b></div>
    <div><b>5: Strongly agree</b></div>
  </div>

  <div class="q14-numbers">
    <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
  </div>

  {{ for fname, suffix in q14_rows }}
    <div class="q14-row">
      <div class="q14-text">{{ suffix }}</div>

      <!-- REAL oTree form field (name=fname) -->
      <input
        type="range"
        name="{{ fname }}"
        min="1" max="5" step="1"
        class="q14-slider"
        required
        value="3"
        data-default="3"
      />
      {{ formfield_errors fname }}


      {{ formfield_errors fname }}
    </div>
  {{ endfor }}
</div>

<hr style="margin: 28px 0;">

<hr style="margin: 28px 0;">

<!-- ===================== Q15 ===================== -->
<p><b>{{ form.bnpl_necessities.label }}</b></p>

<!-- REAL oTree field (kept, but hidden). Required validation still applies. -->
<div class="sr-only-field">
  {{ form.bnpl_necessities }}
</div>

<div class="q15-tiles" role="radiogroup" aria-label="Q15">
  <button type="button" class="q15-tile" data-value="Encourages more purchase">
    Encourages more purchase
  </button>

  <button type="button" class="q15-tile" data-value="No effect">
    No effect
  </button>

  <button type="button" class="q15-tile" data-value="Less purchase">
    Less purchase
  </button>
</div>

{{ formfield_errors 'bnpl_necessities' }}


{{ next_button }}

<script>
(function () {
  document.querySelectorAll('.q14-slider').forEach(sl => {
    if (!sl.value) sl.value = sl.dataset.default || 3;
  });
})();

(function () {
  // --- Q15 tiles -> real radio field ---
  const radios = Array.from(document.querySelectorAll('input[name="bnpl_necessities"]'));
  const tiles  = Array.from(document.querySelectorAll('.q15-tile'));

  function setActive(value) {
    tiles.forEach(t => t.classList.toggle('active', t.dataset.value === value));
  }

  // If returning to page, reflect saved selection
  const checked = radios.find(r => r.checked);
  if (checked) setActive(checked.value);

  tiles.forEach(tile => {
    tile.addEventListener('click', () => {
      const v = tile.dataset.value;
      const r = radios.find(x => x.value === v);
      if (r) {
        r.checked = true;
        // trigger change for any listeners / browser validity UI
        r.dispatchEvent(new Event('change', { bubbles: true }));
      }
      setActive(v);
    });
  });
})();
</script>

<style>
  .q14-scale{ max-width: 820px; }

  .q14-anchors{
    display:flex;
    justify-content:space-between;
    font-size:14px;
    color:#333;
    margin-bottom: 8px;
  }

  .q14-numbers{
    display:flex;
    justify-content:space-between;
    font-size:14px;
    color:#333;
    margin: 6px 0 14px;
    padding: 0 2px;
  }

  .q14-row{
    margin: 18px 0 22px;
  }

  .q14-text{
    margin-bottom: 10px;
    color:#333;
  }

  .q14-slider{
    width: 100%;
    accent-color: #444; /* Qualtrics-like */
    display:block;
  }
  .sr-only-field {
    position: absolute;
    left: -9999px;
    width: 1px;
    height: 1px;
    overflow: hidden;
  }

  .q15-tiles{
    max-width: 820px;
    margin-top: 14px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .q15-tile{
    width: 100%;
    text-align: left;
    padding: 18px 18px;
    border-radius: 10px;
    border: 1px solid #e5e7eb;
    background: #f3f4f6;
    color: #111827;
    font-size: 16px;
    cursor: pointer;
  }

  .q15-tile:hover{
    background: #eef2ff;
  }

  .q15-tile.active{
    border-color: #0d6efd;
    background: #e7f1ff;
  }

</style>

{{ endblock }}
